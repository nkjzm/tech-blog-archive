---
title: "Qiita API v2ã§è‡ªåˆ†ã®è¨˜äº‹ä¸€è¦§ã‚’å–å¾—ã—Notion APIã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«è¨˜éŒ²ã™ã‚‹ã€Unityã€‘"
emoji: "ğŸ®"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Unity", "Notion"]
published: true
---

ã“ã®è¨˜äº‹ã¯ 2022/02 ã« Qiita ã«æŠ•ç¨¿ã•ã‚ŒãŸè¨˜äº‹ã‚’å†æŠ•ç¨¿ã—ã¦ã„ã¾ã™ã€‚

# ã¯ã˜ã‚ã«

ç§ã¯è‡ªåˆ†ã®è¡Œã£ã¦ããŸã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£æ´»å‹•ã‚’Notionã§ã¾ã¨ã‚ã¦è¨˜éŒ²ã—ã¦ã„ã¾ã™ã€‚

ãƒšãƒ¼ã‚¸

https://nkjzm.jp/a268d0d886cc4360ad770a6709aa83ae

ã‚¹ã‚¯ã‚·ãƒ§
![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/55365/4028f3df-24bb-6724-498c-5a51e680bb57.png)

å„æ´»å‹•ã‚’ç®¡ç†ã—ã¦ã„ã‚‹ã‚¦ã‚§ãƒ–ã‚µãƒ¼ãƒ“ã‚¹ãŒçµ‚äº†ã—ã¦ã‚‚è¨˜éŒ²ã‚’å‚ç…§ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã—ã€ã©ã‚“ãªã“ã¨ã‚’ã‚„ã£ã¦ããŸã®ã‹æ¨ªæ–­çš„ã«è¦‹ã‚‰ã‚Œã¦æ°—ã«å…¥ã£ã¦ã„ã‚‹ã®ã§ã™ãŒã€æ›´æ–°ä½œæ¥­ã‚’è¡Œã£ã¦ã„ãŸã¨ã“ã‚ã¡ã‚‡ã£ã¨ã—ãŸå•é¡ŒãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã„ã¤ã®é–“ã«ã‹è‡ªåˆ†ã®æ›¸ã„ãŸæŠ€è¡“è¨˜äº‹ãŒã€Œ100ã€ã‚’è¶…ãˆã¦ãŠã‚Šã€æ‰‹å‹•ã§è¿½åŠ ã—ã¦ã„ãã®ã¯ã‹ãªã‚Šå¤§å¤‰ã ã¨æ€ã„ã¾ã—ãŸã€‚

![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/55365/28bb38e1-4bdd-2e09-b17c-49843224255f.png)


ãã“ã§ä»Šå›ã¯ API ã®å‹‰å¼·ãŒã¦ã‚‰ã« Qiita API ã¨ Notion APIã®é€£æºã‚’è©¦ã—ã¦ã¿ãŸã®ã§ã€ç°¡å˜ã«ç´¹ä»‹ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚

# ç’°å¢ƒ

- Unity 2020.3.26f1
- Qiita API v2
- Notion API Beta

ã‚„ã‚‹ã“ã¨ã¨ã—ã¦ã¯ API å©ã„ã¦ç¹‹ãã“ã‚€ã ã‘ãªã®ã§ã™ãŒã€JSONã®ãƒ‘ãƒ¼ã‚¹ãªã©ãŒå¿…è¦ã ã£ãŸã®ã§ä½¿ã„æ…£ã‚ŒãŸUnityã‚’ä½¿ã„ã¾ã—ãŸã€‚

é€†ã«ã“ã†ã„ã†æ™‚ã£ã¦ä½•ä½¿ã†ã®ãŒã„ã„ã‚“ã§ã™ã‹ã­ãƒ»ãƒ»ï¼Ÿä½•ã‹ãŠã™ã™ã‚ã®è¨€èªã‚„ç’°å¢ƒãªã©ã‚ã‚Œã°ãœã²æ•™ãˆã¦ãã ã•ã„ï¼ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆã§ã‚‚ [Twitter @nkjzm](https://twitter.com/nkjzm)å®›ã¦ã§ã‚‚ï¼ï¼‰

# å®Ÿè£…

## Qiita API

ã“ã¡ã‚‰ã®è¨˜äº‹ã‚’ã¿ã¦å®Ÿè£…ã—ã¾ã—ãŸã€‚ç‰¹ã«ãƒãƒã‚‹ã“ã¨ã‚‚ãªãç°¡å˜ã§ã—ãŸã€‚

https://qiita.com/charon/items/1d27a0dde1eeafe38910

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§å–å¾—ã§ãã‚‹è¨˜äº‹æ•°ãŒ20ä»¶ãªã®ã§ã€ãã‚Œä»¥ä¸Šå–å¾—ã™ã‚‹å ´åˆã¯ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã¿ãŸã„ã§ã™ã€‚æœ€å¤§100ä»¶ã ã£ãŸã®ã§ã€ãƒšãƒ¼ã‚¸æŒ‡å®šã§è¤‡æ•°å›å‘¼ã¶ã“ã¨ã§è§£æ±ºã—ã¦ã„ã¾ã™ã€‚

```.cs
    private async UniTask<List<Data>> GetQiita(int page)
    {
        // 100å‰£ãšã¤å–å¾—
        var url = $"https://qiita.com/api/v2/authenticated_user/items?page={page}&per_page=100";

        // çœç•¥
```


## Notion API

åŸç½ªÎ²ãªã®ã§ãã®ã†ã¡ä»•æ§˜å¤‰ã‚ã‚‹ã‹ã‚‚ã€‚ã“ã¡ã‚‰ã®ãƒšãƒ¼ã‚¸ã‚’å‚è€ƒã«å®Ÿè£…ã—ã¾ã—ãŸã€‚

https://qiita.com/thomi40/items/fe2a828746f31ad827ba

ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®ã‚¢ã‚¤ãƒ†ãƒ è¿½åŠ ã¯ãƒšãƒ¼ã‚¸ã®è¿½åŠ æ‰±ã„ã«ãªã£ã¦ã„ã‚‹ç‚¹ãŒãƒŸã‚½ã§ã™ã€‚ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®æ‰±ã„ãŒçµæ§‹å¤§å¤‰ã ã£ãŸã®ã§ã™ãŒã€APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨ã«ã‚‰ã‚ã£ã“ã—ãŸã‚Šã€è¿”ã£ã¦ãã‚‹ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã‚‰ï¼ˆxxã¨ã„ã†KeyãŒå¿…è¦ã‚‰ã—ã„ãƒ»ãƒ»ï¼‰ã¿ãŸã„ãªæƒ…å ±ã‚’èª­ã¿å–ã£ã¦ãƒˆãƒ©ã‚¤ã‚¨ãƒ©ãƒ¼ã—ã¾ã—ãŸã€‚è‹¦ã—ã‹ã£ãŸãƒ»ãƒ»

https://notion-group.readmepreview.com/reference/property-value-object

## Unityã§ã®jsonã®æ‰±ã„ã«ã¤ã„ã¦

ä»Šå›ã¯Unityæ¨™æº–ã® JsonUtility ã§ã¯ãªãã€Json.NET ã‚’æ¡ç”¨ã—ã¾ã—ãŸã€‚

ç†ç”±ã¯ Qiita API ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ã—ã¦è¿”ã£ã¦ãã‚‹ json ã®ãƒ«ãƒ¼ãƒˆãŒé…åˆ—ã«ãªã£ã¦ã„ã‚‹ãŸã‚ã§ã™ã€‚Json Utility ã¯æœªå¯¾å¿œã§ã™ã€‚

ãã®ä»–ã®é¸æŠè‚¢ã¨ã—ã¦ Utf8Json ãªã©ã‚‚ã‚ã‚Šã¾ã—ãŸãŒã€æœ€è¿‘ã¯ã—ã°ã‚‰ãæ›´æ–°ãŒãªã‹ã£ãŸã‚Šã™ã‚‹ã®ã§ä»Šåº¦ã‚ã¾ã‚Šä½¿ã†å ´é¢ãªã•ãã†ã‹ãªï½ã¨æ€ã„ Json.NETã‚’è©¦ã—ã¦ã¿ã¾ã—ãŸã€‚ï¼ˆã¡ãªã¿ã«ä»¥å‰ã¯çµæ§‹ä½¿ã£ã¦ã¦å¤§å¤‰ãŠä¸–è©±ã«ãªã‚Šã¾ã—ãŸmmï¼‰

https://github.com/neuecc/Utf8Json

ç¢ºã‹ã©ã“ã‹ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‹ã‚‰Unityã§ã®æ¨™æº–ã§åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã¯ãšã§ã™ã€‚ä½¿ã„æ–¹ã¯ä¸‹è¨˜ã®è¨˜äº‹ãŒå‚è€ƒã«ãªã‚Šã¾ã—ãŸã€‚

https://qiita.com/yun_bow/items/f20bd38ded1a27e658f6

è‹¥å¹²è©°ã¾ã£ãŸã“ã¨ã¨ã—ã¦ã€ãƒ«ãƒ¼ãƒˆé…åˆ—ã®å ´åˆã¯åˆã‚ã« `JArray` ã§ãƒ‘ãƒ¼ã‚¹ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚ã”æ³¨æ„ãã ã•ã„ã€‚

```.cs
        var json = request.downloadHandler.text;
        JArray jsonArray = JArray.Parse(json);
        foreach (var jToken in jsonArray)
        {
            var jo = JObject.Parse(jToken.ToString());
            list.Add(new Data
            {
                title = jo["title"].ToString(),
                dateTime = DateTime.Parse(jo["created_at"].ToString()),
                url = jo["url"].ToString()
            });
        }
```

## ã‚³ãƒ¼ãƒ‰

ä»Šå›æ›¸ã„ãŸã‚³ãƒ¼ãƒ‰ã§ã™ã€ã™ã”ã„æ±šã„ã§ã™ã€‚

```.cs
using System;
using System.Collections.Generic;
using Cysharp.Threading.Tasks;
using Newtonsoft.Json;
using Newtonsoft.Json.Linq;
using UnityEngine;
using UnityEngine.Networking;

public class Controller : MonoBehaviour
{
    private const string QiitaAccessToken = "ã»ã’ã»ã’";
    private const string NotionAccessToken = "ãµãŒãµãŒ";
    private const string DatabaseId = "ãã‚‹ãã‚‹";

    // 100ä»¶å˜ä½ã§å–å¾—ã™ã‚‹ã®ã§ ä¸Šã®æ¡ã ã‘æ­£ã—ãæ›´æ–°ã™ã‚‹ã“ã¨
    private const int PostCount = 150;

    void Start() => Action();

    public async void Action()
    {
        var list = await GetQiita();
        foreach (var data in list)
        {
            AddNotion(data.title, data.dateTime, data.url);
        }
    }

    private class Data
    {
        public string title;
        public DateTime dateTime;
        public string url;
    }

    private async UniTask<List<Data>> GetQiita()
    {
        var list = new List<Data>();
        var pageCount = Mathf.CeilToInt(PostCount / 100f);
        for (int i = 0; i < pageCount; i++)
        {
            list.AddRange(await GetQiita(i + 1));
        }

        return list;
    }

    private async UniTask<List<Data>> GetQiita(int page)
    {
        // 100å‰£ãšã¤å–å¾—
        var request =
            UnityWebRequest.Get($"https://qiita.com/api/v2/authenticated_user/items?page={page}&per_page=100");
        request.SetRequestHeader("Authorization", $"Bearer {QiitaAccessToken}");

        await request.SendWebRequest();

        if (request.result != UnityWebRequest.Result.Success)
        {
            Debug.LogError(request.error);
            return null;
        }

        var json = request.downloadHandler.text;
        Debug.Log(json);
        JArray jsonArray = JArray.Parse(json);
        var list = new List<Data>();

        foreach (var jToken in jsonArray)
        {
            var jo = JObject.Parse(jToken.ToString());
            list.Add(new Data
            {
                title = jo["title"].ToString(),
                dateTime = DateTime.Parse(jo["created_at"].ToString()),
                url = jo["url"].ToString()
            });
        }

        return list;
    }

    private async void AddNotion(string title, DateTime dateTime, string url)
    {
        // ref: https://notion-group.readmepreview.com/reference/property-object
        string strData = dateTime.ToString("yyyy-MM-dd");

        JObject jsonObj = new JObject
        {
            ["parent"] = new JObject
            {
                ["database_id"] = DatabaseId
            },
            ["properties"] = new JObject
            {
                ["title"] = new JObject
                {
                    ["title"] = new JArray
                    {
                        new JObject
                        {
                            ["text"] = new JObject
                            {
                                ["content"] = title
                            }
                        }
                    }
                },
                ["Date"] = new JObject
                {
                    ["date"] = new JObject
                    {
                        ["start"] = strData
                    }
                },
                ["Tags"] = new JObject
                {
                    ["select"] = new JObject
                    {
                        ["name"] = "è¨˜äº‹æŠ•ç¨¿"
                    }
                },
                ["URL"] = new JObject
                {
                    ["url"] = url
                },
            },
        };
        string jsonStr = JsonConvert.SerializeObject(jsonObj, Formatting.None);
        byte[] postData = System.Text.Encoding.UTF8.GetBytes(jsonStr);

        var request = new UnityWebRequest("https://api.notion.com/v1/pages", UnityWebRequest.kHttpVerbPOST)
        {
            uploadHandler = new UploadHandlerRaw(postData),
            downloadHandler = new DownloadHandlerBuffer()
        };
        request.SetRequestHeader("Authorization", $"Bearer {NotionAccessToken}");
        request.SetRequestHeader("Content-Type", "application/json");
        request.SetRequestHeader("Notion-Version", "2021-08-16");

        await request.SendWebRequest();

        if (request.result != UnityWebRequest.Result.Success)
        {
            Debug.LogError(request.error);
            return;
        }

        Debug.Log($"ok: {title}");
    }
}
```

# æœ€å¾Œã«

ã“ã†ã„ã†åŠ¹ç‡åŒ–ã‚ã‚‹ã‚ã‚‹ãªã‚“ã§ã™ã‘ã©ã€åˆã‚ã¦ã®APIä½¿ã£ãŸã‚ŠJSONã®ãƒ‘ãƒ¼ã‚¹ã§ãƒˆãƒ©ã‚¤ã‚¨ãƒ©ãƒ¼ã—ã¦ã„ã‚‹ã†ã¡ã«2æ™‚é–“ãŒçµŒã¡ã¾ã—ãŸã€‚ã¾ãŸè¨˜äº‹æ›¸ã„ã¦ãŸã®ã§ã‹ã‚Œã“ã‚Œ3æ™‚é–“ãã‚‰ã„çµŒã£ã¦ã„ã¾ã™ã€‚~~æ‰‹å‹•ã§Notionã«ç™»éŒ²ã—ã¦è¨€ã£ãŸæ–¹ãŒæ—©ã‹ã£ãŸã‚“ã˜ã‚ƒãƒ»ãƒ»ãƒ»~~ ãªã‚“ã¦ã“ã¨ã‚’æ€ã£ãŸã‚Šã‚‚ã—ã¾ã—ãŸãŒã€æ¥½ã—ã‹ã£ãŸã®ã§ï¼¯ï¼«ã§ã™ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼


ã‚ˆã‹ã£ãŸã‚‰ Twitter ã®ãƒ•ã‚©ãƒ­ãƒ¼ã‚‚ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ï¼â†’ [@nkjzm](https://twitter.com/nkjzm)




